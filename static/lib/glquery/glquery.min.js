/*
 * glQuery - A fluent WebGL engine (https://github.com/glQuery)
 * glQuery is free, public domain software (http://creativecommons.org/publicdomain/zero/1.0/)
 * Originally created by Rehno Lindeque of http://www.mischievousmeerkat.com
 */var glQuery=function(){"use strict";var a=function(b){return a.fn.init(b)},b={},c=[],d={},e=[],f={},g={},h=0,i=[],j={contextlost:[],contextrestored:[],contextcreationerror:[]},k=function(a){},l=function(a){console.log(a)},m=function(a){console.warn(a)},n=function(a){console.error(a)},o=function(a,b){console.error("In call to '"+a+"', "+b)},p=function(a,b){return a||n(b),a},q=function(a,b,c,d){return d!=null&&c!=null?p(typeof a===b,"In call to '"+c+"', expected type '"+b+"' for '"+d+"'. Instead, got type '"+typeof a+"'."):c!=null?p(typeof a===b,"In call to '"+c+"', expected type '"+b+"'. Instead, got type '"+typeof a+"'."):d!=null?p(typeof a===b,"Expected type '"+b+"' for '"+d+"'. Instead, got type '"+typeof a+"'."):p(typeof a===b,"Expected type '"+b+"'. Instead, got type '"+typeof a+"'.")},r=function(a,b,c){return c!=null?p(a.length>=b,"In call to '"+c+"', expected at least "+b+" arguments. Instead, got "+a.length+"."):p(a.length>=b,"Expected at least "+b+" arguments. Instead, got "+a.length+".")},s=p,t=0,u=function(){var a="__glq__"+t;return++t,a},v=function(a){if(Array.isArray(a)){var b=[];b.hashes={},b.lastUpdate=0;for(var c=0;c<a.length;++c){var e=v(a[c]);if(Array.isArray(a)){var f={};f[u()]=b,b.push(f)}e!=null?b.push(e):o("scene","could not normalize the node with type '"+typeof a[c]+"'.")}return b}switch(typeof a){case"string":var g=a.split(" ");for(var c=0;c<g.length;++c)typeof d[g[c]]=="undefined"&&(d[g[c]]=new Array(F.length));return a;case"number":var h=String(a);return typeof d[h]=="undefined"&&(d[h]=new Array(F.length)),h;case"object":var i={};for(var j in a){if(j==="prototype"){n("The given nodes contain a 'prototype' object. ");continue}v(j);var k=v(a[j]);if(Array.isArray(k))i[j]=k;else{var l=k!=null?[k]:[];l.hashes={},l.lastUpdate=0,i[j]=l}}return i}};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimationFrame=function(){return window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}();var w=[1,1,2,2,4,4,4];a.DEPTH_BUFFER_BIT=256,a.STENCIL_BUFFER_BIT=1024,a.COLOR_BUFFER_BIT=16384,a.POINTS=0,a.LINES=1,a.LINE_LOOP=2,a.LINE_STRIP=3,a.TRIANGLES=4,a.TRIANGLE_STRIP=5,a.TRIANGLE_FAN=6,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.FUNC_ADD=32774,a.BLEND_EQUATION=32777,a.BLEND_EQUATION_RGB=32777,a.BLEND_EQUATION_ALPHA=34877,a.FUNC_SUBTRACT=32778,a.FUNC_REVERSE_SUBTRACT=32779,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.ARRAY_BUFFER=34962,a.ELEMENT_ARRAY_BUFFER=34963,a.ARRAY_BUFFER_BINDING=34964,a.ELEMENT_ARRAY_BUFFER_BINDING=34965,a.STREAM_DRAW=35040,a.STATIC_DRAW=35044,a.DYNAMIC_DRAW=35048,a.BUFFER_SIZE=34660,a.BUFFER_USAGE=34661,a.CURRENT_VERTEX_ATTRIB=34342,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,a.CULL_FACE=2884,a.BLEND=3042,a.DITHER=3024,a.STENCIL_TEST=2960,a.DEPTH_TEST=2929,a.SCISSOR_TEST=3089,a.POLYGON_OFFSET_FILL=32823,a.SAMPLE_ALPHA_TO_COVERAGE=32926,a.SAMPLE_COVERAGE=32928,a.NO_ERROR=0,a.INVALID_ENUM=1280,a.INVALID_VALUE=1281,a.INVALID_OPERATION=1282,a.OUT_OF_MEMORY=1285,a.CW=2304,a.CCW=2305,a.LINE_WIDTH=2849,a.ALIASED_POINT_SIZE_RANGE=33901,a.ALIASED_LINE_WIDTH_RANGE=33902,a.CULL_FACE_MODE=2885,a.FRONT_FACE=2886,a.DEPTH_RANGE=2928,a.DEPTH_WRITEMASK=2930,a.DEPTH_CLEAR_VALUE=2931,a.DEPTH_FUNC=2932,a.STENCIL_CLEAR_VALUE=2961,a.STENCIL_FUNC=2962,a.STENCIL_FAIL=2964,a.STENCIL_PASS_DEPTH_FAIL=2965,a.STENCIL_PASS_DEPTH_PASS=2966,a.STENCIL_REF=2967,a.STENCIL_VALUE_MASK=2963,a.STENCIL_WRITEMASK=2968,a.STENCIL_BACK_FUNC=34816,a.STENCIL_BACK_FAIL=34817,a.STENCIL_BACK_PASS_DEPTH_FAIL=34818,a.STENCIL_BACK_PASS_DEPTH_PASS=34819,a.STENCIL_BACK_REF=36003,a.STENCIL_BACK_VALUE_MASK=36004,a.STENCIL_BACK_WRITEMASK=36005,a.VIEWPORT=2978,a.SCISSOR_BOX=3088,a.COLOR_CLEAR_VALUE=3106,a.COLOR_WRITEMASK=3107,a.UNPACK_ALIGNMENT=3317,a.PACK_ALIGNMENT=3333,a.MAX_TEXTURE_SIZE=3379,a.MAX_VIEWPORT_DIMS=3386,a.SUBPIXEL_BITS=3408,a.RED_BITS=3410,a.GREEN_BITS=3411,a.BLUE_BITS=3412,a.ALPHA_BITS=3413,a.DEPTH_BITS=3414,a.STENCIL_BITS=3415,a.POLYGON_OFFSET_UNITS=10752,a.POLYGON_OFFSET_FACTOR=32824,a.TEXTURE_BINDING_2D=32873,a.SAMPLE_BUFFERS=32936,a.SAMPLES=32937,a.SAMPLE_COVERAGE_VALUE=32938,a.SAMPLE_COVERAGE_INVERT=32939,a.NUM_COMPRESSED_TEXTURE_FORMATS=34466,a.COMPRESSED_TEXTURE_FORMATS=34467,a.DONT_CARE=4352,a.FASTEST=4353,a.NICEST=4354,a.GENERATE_MIPMAP_HINT=33170,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.DEPTH_COMPONENT=6402,a.ALPHA=6406,a.RGB=6407,a.RGBA=6408,a.LUMINANCE=6409,a.LUMINANCE_ALPHA=6410,a.UNSIGNED_SHORT_4_4_4_4=32819,a.UNSIGNED_SHORT_5_5_5_1=32820,a.UNSIGNED_SHORT_5_6_5=33635,a.FRAGMENT_SHADER=35632,a.VERTEX_SHADER=35633,a.MAX_VERTEX_ATTRIBS=34921,a.MAX_VERTEX_UNIFORM_VECTORS=36347,a.MAX_VARYING_VECTORS=36348,a.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,a.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,a.MAX_TEXTURE_IMAGE_UNITS=34930,a.MAX_FRAGMENT_UNIFORM_VECTORS=36349,a.SHADER_TYPE=35663,a.DELETE_STATUS=35712,a.LINK_STATUS=35714,a.VALIDATE_STATUS=35715,a.ATTACHED_SHADERS=35717,a.ACTIVE_UNIFORMS=35718,a.ACTIVE_ATTRIBUTES=35721,a.SHADING_LANGUAGE_VERSION=35724,a.CURRENT_PROGRAM=35725,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.KEEP=7680,a.REPLACE=7681,a.INCR=7682,a.DECR=7683,a.INVERT=5386,a.INCR_WRAP=34055,a.DECR_WRAP=34056,a.VENDOR=7936,a.RENDERER=7937,a.VERSION=7938,a.NEAREST=9728,a.LINEAR=9729,a.NEAREST_MIPMAP_NEAREST=9984,a.LINEAR_MIPMAP_NEAREST=9985,a.NEAREST_MIPMAP_LINEAR=9986,a.LINEAR_MIPMAP_LINEAR=9987,a.TEXTURE_MAG_FILTER=10240,a.TEXTURE_MIN_FILTER=10241,a.TEXTURE_WRAP_S=10242,a.TEXTURE_WRAP_T=10243,a.TEXTURE_2D=3553,a.TEXTURE=5890,a.TEXTURE_CUBE_MAP=34067,a.TEXTURE_BINDING_CUBE_MAP=34068,a.TEXTURE_CUBE_MAP_POSITIVE_X=34069,a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,a.MAX_CUBE_MAP_TEXTURE_SIZE=34076,a.TEXTURE0=33984,a.TEXTURE1=33985,a.TEXTURE2=33986,a.TEXTURE3=33987,a.TEXTURE4=33988,a.TEXTURE5=33989,a.TEXTURE6=33990,a.TEXTURE7=33991,a.TEXTURE8=33992,a.TEXTURE9=33993,a.TEXTURE10=33994,a.TEXTURE11=33995,a.TEXTURE12=33996,a.TEXTURE13=33997,a.TEXTURE14=33998,a.TEXTURE15=33999,a.TEXTURE16=34e3,a.TEXTURE17=34001,a.TEXTURE18=34002,a.TEXTURE19=34003,a.TEXTURE20=34004,a.TEXTURE21=34005,a.TEXTURE22=34006,a.TEXTURE23=34007,a.TEXTURE24=34008,a.TEXTURE25=34009,a.TEXTURE26=34010,a.TEXTURE27=34011,a.TEXTURE28=34012,a.TEXTURE29=34013,a.TEXTURE30=34014,a.TEXTURE31=34015,a.ACTIVE_TEXTURE=34016,a.REPEAT=10497,a.CLAMP_TO_EDGE=33071,a.MIRRORED_REPEAT=33648,a.FLOAT_VEC2=35664,a.FLOAT_VEC3=35665,a.FLOAT_VEC4=35666,a.INT_VEC2=35667,a.INT_VEC3=35668,a.INT_VEC4=35669,a.BOOL=35670,a.BOOL_VEC2=35671,a.BOOL_VEC3=35672,a.BOOL_VEC4=35673,a.FLOAT_MAT2=35674,a.FLOAT_MAT3=35675,a.FLOAT_MAT4=35676,a.SAMPLER_2D=35678,a.SAMPLER_CUBE=35680,a.VERTEX_ATTRIB_ARRAY_ENABLED=34338,a.VERTEX_ATTRIB_ARRAY_SIZE=34339,a.VERTEX_ATTRIB_ARRAY_STRIDE=34340,a.VERTEX_ATTRIB_ARRAY_TYPE=34341,a.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,a.VERTEX_ATTRIB_ARRAY_POINTER=34373,a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,a.COMPILE_STATUS=35713,a.LOW_FLOAT=36336,a.MEDIUM_FLOAT=36337,a.HIGH_FLOAT=36338,a.LOW_INT=36339,a.MEDIUM_INT=36340,a.HIGH_INT=36341,a.FRAMEBUFFER=36160,a.RENDERBUFFER=36161,a.RGBA4=32854,a.RGB5_A1=32855,a.RGB565=36194,a.DEPTH_COMPONENT16=33189,a.STENCIL_INDEX=6401,a.STENCIL_INDEX8=36168,a.DEPTH_STENCIL=34041,a.RENDERBUFFER_WIDTH=36162,a.RENDERBUFFER_HEIGHT=36163,a.RENDERBUFFER_INTERNAL_FORMAT=36164,a.RENDERBUFFER_RED_SIZE=36176,a.RENDERBUFFER_GREEN_SIZE=36177,a.RENDERBUFFER_BLUE_SIZE=36178,a.RENDERBUFFER_ALPHA_SIZE=36179,a.RENDERBUFFER_DEPTH_SIZE=36180,a.RENDERBUFFER_STENCIL_SIZE=36181,a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,a.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,a.COLOR_ATTACHMENT0=36064,a.DEPTH_ATTACHMENT=36096,a.STENCIL_ATTACHMENT=36128,a.DEPTH_STENCIL_ATTACHMENT=33306,a.NONE=0,a.FRAMEBUFFER_COMPLETE=36053,a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,a.FRAMEBUFFER_UNSUPPORTED=36061,a.FRAMEBUFFER_BINDING=36006,a.RENDERBUFFER_BINDING=36007,a.MAX_RENDERBUFFER_SIZE=34024,a.INVALID_FRAMEBUFFER_OPERATION=1286,a.UNPACK_FLIP_Y_WEBGL=37440,a.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,a.CONTEXT_LOST_WEBGL=37442,a.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,a.BROWSER_DEFAULT_WEBGL=37444,a.update=function(){return c.length>0},a.refresh=function(a){a instanceof WebGLProgram&&a["_glquery_id"]!=null&&(g[a._glquery_id]={})};var x=function(a,b){var c=a.split(" ");for(var d=0;d<c.length;++d){if(c[d]==="")continue;for(var e=0;e<b.length;++e)if(c[d]===b[e])return!0}return!1},y=function(a,b,c){for(var e=0;e<a.length;++e){var f=d[a[e]];if(typeof f=="undefined")continue;b.push(f);var g=f[C.shaderProgram];g!=null&&(c[C.shaderProgram]=g)}},z=function(a,b,c){var d=function(a){return a[C.shaderProgram].join("$")};s(a.hashes!=null&&typeof a.lastUpdate!="undefined","Node properties are not properly initialized.");if(a.lastUpdate>0){a.lastUpdate=2;return}a.hashes={},typeof b=="undefined"&&(b=[]),typeof c=="undefined"&&(c=[[]]);for(var e=0;e<a.length;++e)if(typeof a[e]=="string"){var f=[],g=c.slice();y(a[e].split(" "),f,g);var h=d(g),i=a.hashes[h];typeof i=="undefined"&&(i=a.hashes[h]=[]),i.push(b.concat(f))}else for(var j in a[e]){var f=[],g=c.slice();y(a[e].split(" "),f,g);var k=a[e][j];a.lastUpdate===-1&&(k.lastUpdate=-1),f=b.concat(f),z(k,f,g);for(var h in k.hashes){var i=a.hashes[h];typeof i=="undefined"?a.hashes[h]=k.hashes[h]:a.hashes[h]=i.concat(k.hashes[h])}}a.lastUpdate=1},A=function(a){if(typeof b[a]=="undefined")return;var c=[],d=[[]];y(a.split(" "),c,d),z(b[a],c,d)},B=function(a){var c=function(a,b,d){if(x(b,a))d.lastUpdate=-1;else for(var e=0;e<d.length;++e){var f=d[e];if(typeof f=="string"){if(d.lastUpdate<1)continue;x(f,a)&&(d.lastUpdate=0)}else for(var b in f){var f=f[b];c(a,b,f),f.lastUpdate<1&&(d.lastUpdate=0)}}};for(var d in b)c(a,d,b[d])},C={shaderProgram:0,geometry:1,vertexElem:2,vertexAttribBuffer:3,vertexAttrib1:4,vertexAttrib2:5,vertexAttrib3:6,vertexAttrib4:7,uniform:8,insert:9,remove:10},D={hashedState:1,unhashedState:2,unhashedStateDictionary:6,sceneGraph:2},E=[function(a,b,c){k("dispatch command: shaderProgram");if(c.length>0){var e;if(c[0]instanceof WebGLProgram)e=c[0];else if(c[0]instanceof WebGLShader){n("Internal Error: shaderProgram(WebGLShader, ...) is not yet supported by glQuery.");return}e._glquery_id=h,++h;if(g[e._glquery_id]==null){var f=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES),i=a.getProgramParameter(e,a.ACTIVE_UNIFORMS),j=g[e._glquery_id]={attributes:{},uniforms:{}};for(var l=0;l<f;++l){var m=a.getActiveAttrib(e,l);j.attributes[m.name]=a.getAttribLocation(e,m.name)}for(var l=0;l<i;++l){var o=a.getActiveUniform(e,l);j.uniforms[o.name]={location:a.getUniformLocation(e,o.name),size:o.size,type:o.type}}}for(var l=0;l<b.length;++l){var p=d[b[l]];p[C.shaderProgram]=e}}else for(var l=0;l<b.length;++l)typeof d[b[l]]!="undefined"&&delete d[b[l]][C.shaderProgram]},function(a,b,c){k("dispatch command: geometry");if(c.length>0)for(var e=0;e<b.length;++e){var f=d[b[e]];f[C.geometry]=c}else for(var e=0;e<b.length;++e)typeof d[b[e]]!="undefined"&&delete d[b[e]][C.geometry]},function(a,b,c){k("dispatch command: vertexElem");if(c[0]==null){for(var e=0;e<b.length;++e)typeof d[b[e]]!="undefined"&&delete d[b[e]][C.vertexElem];return}switch(c.length){case 2:c.push(a.UNSIGNED_SHORT);case 3:c.push(0)}for(var e=0;e<b.length;++e){var f=typeof d[b[e]]=="undefined"?d[b[e]]={}:d[b[e]];f[C.vertexElem]=c}},function(a,b,c){k("dispatch command: vertexAttribBuffer");if(c[0]==null){for(var e=0;e<b.length;++e)typeof d[b[e]]!="undefined"&&delete d[b[e]][C.vertexAttribBuffer];return}if(c[1]==null)return;for(var e=0;e<b.length;++e){var f=typeof d[b[e]]=="undefined"?d[b[e]]={}:d[b[e]];f[C.vertexAttribBuffer]=c}},function(a,b,c){k("dispatch command: vertexAttrib1")},function(a,b,c){k("dispatch command: vertexAttrib2")},function(a,b,c){k("dispatch command: vertexAttrib3")},function(a,b,c){k("dispatch command: vertexAttrib4")},function(a,b,c){k("dispatch command: uniform");if(c[0]==null){for(var e=0;e<b.length;++e)typeof d[b[e]]!="undefined"&&delete d[b[e]][C.uniform];return}if(c[1]==null)return;for(var e=0;e<b.length;++e){var f=typeof d[b[e]]=="undefined"?d[b[e]]={}:d[b[e]],g=f[C.uniform],h=c.slice(1);g==null&&(g=f[C.uniform]={}),g[c[0]]=h.length==1||h.length>0&&Array.isArray(h[0])?h:[h]}},function(a,b,c){k("dispatch command: insert")},function(a,b,c){k("dispatch command: remove")}],F=[function(a,b,c){k("eval command: shaderProgram"),a.useProgram(c),b.shaderProgram=c},function(a,b,c){k("eval command: geometry"),b.useElements?a.drawElements(c[0],c[1]!=null?c[1]:b.numVertices,b.elementsType,b.elementsOffset+(c[2]!=null?c[2]:0)):a.drawArrays(c[0],c[2]!=null?c[2]:0,c[1]!=null?c[1]:b.numVertices)},function(a,b,c){k("eval command: vertexElem"),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c[0]),b.numVertices=c[1],b.elementsType=c[2],b.elementsOffset=c[3],b.useElements=!0},function(a,b,c){k("eval command: vertexAttribBuffer");var d=b.shaderProgram!=null?g[b.shaderProgram._glquery_id]:null;if(d!=null){var e=typeof c[0]=="number"?c[0]:d.attributes[c[0]];typeof e!="undefined"&&e!==-1&&(a.bindBuffer(a.ARRAY_BUFFER,c[1]),a.enableVertexAttribArray(e),a.vertexAttribPointer(e,c[4],c[3],c[5],c[6],c[7]),b.useElements||(b.numVertices=Math.min(b.numVertices,c[2]/c[4])))}},function(a,b,c){k("eval command: vertexAttrib1")},function(a,b,c){k("eval command: vertexAttrib2")},function(a,b,c){k("eval command: vertexAttrib3")},function(a,b,c){k("eval command: vertexAttrib4")},function(){var b={};return b[a.FLOAT]=WebGLRenderingContext.prototype.uniform1f,b[a.FLOAT_VEC2]=WebGLRenderingContext.prototype.uniform2fv,b[a.FLOAT_VEC3]=WebGLRenderingContext.prototype.uniform3fv,b[a.FLOAT_VEC4]=WebGLRenderingContext.prototype.uniform4fv,b[a.INT]=WebGLRenderingContext.prototype.uniform1i,b[a.INT_VEC2]=WebGLRenderingContext.prototype.uniform2iv,b[a.INT_VEC3]=WebGLRenderingContext.prototype.uniform3iv,b[a.INT_VEC4]=WebGLRenderingContext.prototype.uniform4iv,b[a.BOOL]=WebGLRenderingContext.prototype.uniform1i,b[a.BOOL_VEC2]=WebGLRenderingContext.prototype.uniform2iv,b[a.BOOL_VEC3]=WebGLRenderingContext.prototype.uniform3iv,b[a.BOOL_VEC4]=WebGLRenderingContext.prototype.uniform4iv,b[a.FLOAT_MAT2]=function(a,b,c){this.uniformMatrix2fv(a,c!=null?c:!1,b)},b[a.FLOAT_MAT3]=function(a,b,c){this.uniformMatrix3fv(a,c!=null?c:!1,b)},b[a.FLOAT_MAT4]=function(a,b,c){this.uniformMatrix4fv(a,c!=null?c:!1,b)},function(a,c,d){k("eval command: uniform");var e=c.shaderProgram!=null?g[c.shaderProgram._glquery_id]:null;if(e!=null)for(var f in d){var h=e.uniforms[f];if(h!=null){var i=h.location,j=d[f];i!=null&&b[h.type].apply(a,[i].concat(j))}}}}()];p(E.length===D.hashedState+D.unhashedState+D.unhashedStateDictionary+D.sceneGraph,"Internal Error: Total commands size does not add up to the correct number."),p(F.length===E.length-D.sceneGraph,"Internal Error: Number of commands in commandEval is incorrect.");var G=function(a,b){for(var c=0;c<b.length;++c){var d=b[c],f=d[0],g=d[1],h=d[2];for(var i=0;i<g.length;++i)e.push(g[i]);E[f](a,g,h)}b.length=0},H=function(a,b,c){k("evalCommands");var d=c[0].slice();d.numVertices=Number.POSITIVE_INFINITY,d.elementsOffset=0,d.elementsType=a.UNSIGNED_SHORT,d.useElements=!1;for(var e=c.length-2;e>=0;--e){var f=c[e];for(var g=0;g<F.length;++g)d[g]==null&&(d[g]=f[g])}for(var e=0;e<F.length;++e)d[e]==null&&(d[e]=b[e]);var h=d[C.shaderProgram];h!=b[C.shaderProgram]&&F[C.shaderProgram](a,d,h);for(var e=C.vertexElem;e<=C.uniform;++e){var i=d[e];i!=null&&i!==b[e]&&F[e](a,d,i)}var j=d[C.geometry];j!=null&&F[C.geometry](a,d,j),b=d};a.command=function(){return r(arguments,1,"command")?p(C[arguments[0]]!=null,"Unknown command '"+C[arguments[0]]+"' used.")?(c.push([C[arguments[0]],C[arguments[1]]!=null?C[arguments[1]]:null,Array.prototype.slice.call(arguments,2)]),a):a:a},a.fn=a.prototype={init:function(){return this._selector=Array.prototype.slice.call(arguments),this},render:function(a){if(!q(a,"object","render","context"))return this;G(a,c);if(e.length>0){B(e);for(var d in b)A(b[d]);e.length=0}var f=function(b,c){for(var d in c.hashes){var e=c.hashes[d];for(var f=0;f<e.length;++f)H(a,b,e[f])}},g=function(a,b,c){for(var d=0;d<b.length;++d){var e=b[d];if(typeof e!="string")for(var h in e)x(h,this._selector)?f(a,e[h]):g(a,e[h],this._selector)}};for(var d in b){var h=new Array(F.length);x(d,this._selector)?f(h,b[d]):g(h,b[d],this._selector)}return this},command:function(){return r(arguments,1,"command")?p(C[arguments[0]]!=null,"Unknown command '"+C[arguments[0]]+"' used.")?(c.push([C[arguments[0]],this._selector,Array.prototype.slice.call(arguments,1)]),this):this:this},shaderProgram:function(){return k("shaderProgram"),c.push([C.shaderProgram,this._selector,Array.prototype.slice.call(arguments)]),this},geometry:function(){return k("geometry"),c.push([C.geometry,this._selector,Array.prototype.slice.call(arguments)]),this},points:function(){return k("points"),c.push([C.geometry,this._selector,[a.POINTS].concat(Array.prototype.slice.call(arguments))]),this},lines:function(){return k("lines"),c.push([C.geometry,this._selector,[a.LINES].concat(Array.prototype.slice.call(arguments))]),this},lineLoop:function(){return k("lineLoop"),c.push([C.geometry,this._selector,[a.LINE_LOOP].concat(Array.prototype.slice.call(arguments))]),this},lineStrip:function(){return k("lineStrip"),c.push([C.geometry,this._selector,[a.LINE_STRIP].concat(Array.prototype.slice.call(arguments))]),this},triangles:function(){return k("triangles"),c.push([C.geometry,this._selector,[a.TRIANGLES].concat(Array.prototype.slice.call(arguments))]),this},triangleStrip:function(){return k("triangleStrip"),c.push([C.geometry,this._selector,[a.TRIANGLE_STRIP].concat(Array.prototype.slice.call(arguments))]),this},triangleFan:function(){return k("triangleFan"),c.push([C.geometry,this._selector,[a.TRIANGLE_FAN].concat(Array.prototype.slice.call(arguments))]),this},vertexAttrib:function(){return k("vertexAttrib"),c.push([C.vertexAttribBuffer,this._selector,Array.prototype.slice.call(Array.prototype.slice.call(arguments))]),this},vertexElem:function(){return k("vertexElem"),c.push([C.vertexElem,this._selector,Array.prototype.slice.call(Array.prototype.slice.call(arguments))]),this},uniform:function(){return k("uniform"),c.push([C.uniform,this._selector,Array.prototype.slice.call(Array.prototype.slice.call(arguments))]),this}};var I={};for(var J in a.fn)I[J]=function(){return this};var K=function(a,b){for(var c=0;c<a.length;++c)a[c][1]&&a[c][0](b)};a.canvas=function(b,c,d,e){var f,g;k("canvas");var h={start:function(){return this},clear:function(){return this},clearColor:function(){return this},clearDepth:function(){return this},clearStencil:function(){return this}};if(typeof b=="undefined")f="glqueryCanvas",document.write("<canvas id='"+f+"' width='"+(d!=null?d:800)+"' height='"+(e!=null?e:800)+"'></canvas>"),g=document.getElementById(f);else{if(!p(typeof b=="string"||typeof b=="object"&&b.nodeName!=="CANVAS","In call to 'canvas', expected type 'string', 'undefined' or 'canvas element' for 'htmlCanvas'. Instead, got type '"+typeof b+"'."))return h;f=typeof b=="string"?b:b.id,g=typeof b=="object"?b:document.getElementById(f)}if(!p(g!=null&&typeof g=="object"&&g.nodeName==="CANVAS","In call to 'canvas', could not initialize canvas element."))return h;f!=null?l("Initialized canvas: "+f):l("Initialized canvas");var m=g.getContext("experimental-webgl",c);return p(m!=null,"Could not get a 'experimental-webgl' context.")?(g.addEventListener("webglcontextlost",function(a){var b;K(j.contextlost,a);for(b=0;b<i.length;++b){var c=i[b];if(c.ctx.canvas!==g)continue;c.nextFrame!=null&&window.cancelAnimationFrame(c.nextFrame);break}a.preventDefault()},!1),g.addEventListener("webglcontextrestored",function(a){var b;K(j.contextrestored,a);for(b=0;b<i.length;++b){var c=i[b];if(c.ctx.canvas!==g)continue;c.nextFrame==null&&c.paused===!1&&window.requestAnimationFrame(c.callback(),c.ctx.canvas);break}},!1),g.addEventListener("webglcontextcreationerror",function(a){K(j.contextcreationerror,a)},!1),function(){var b={ctx:m,rootId:null,nextFrame:null,paused:!0,clearMask:a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT,callback:function(){return b=this,function c(){if(b.ctx.isContextLost())return;b.ctx.clear(b.clearMask),a(b.rootId).render(b.ctx),b.nextFrame=window.requestAnimationFrame(c,b.ctx.canvas)}}};return i.push(b),{start:function(a){k("canvas.start");if(a!=null){if(!q(a,"string","canvas.start","rootId"))return this;b.rootId=a,b.nextFrame=window.requestAnimationFrame(b.callback(),b.ctx.canvas),b.paused=!1}return this},pause:function(){return k("canvas.pause"),window.cancelAnimationFrame(b.nextFrame),b.nextFrame=null,b.paused=!0,this},clear:function(a){return k("canvas.clear"),b.clearMask=a,this},clearColor:function(a,c,d,e){return k("canvas.clearColor"),b.ctx.clearColor(a,c,d,e),this},clearDepth:function(a){return k("canvas.clearDepth"),b.ctx.clearDepth(a),this},clearStencil:function(a){return k("canvas.clearStencil"),b.ctx.clearStencil(a),this}}}()):h},a.scene=function(){k("scene");var c=[];for(var d=0;d<arguments.length;++d){var e=arguments[d];if(Array.isArray(e)){var f=v(u());b[f]=v(e),c.push(f);continue}switch(typeof e){case"string":var f=v(e);b[f]=[],c.push(f);continue;case"number":var f=v(String(e));b[f]=[],c.push(f);continue;default:if(!p(typeof e=="object","In call to 'scene', expected type 'string' ,'number' or 'object' for 'sceneDef'. Instead, got type '"+typeof e+"'."))continue;var g=v(e);if(g!=null)for(J in g)c.push(J),b[J]=g[J]}}if(arguments.length===0)return b={},I;if(c.length===0)return o("could not create scene from the given scene definition."),I;for(var d=0;d<c.length;++d)A(c[d]);return a.fn.init.apply(a.fn,c)},a.shader=function(b,c){k("shader");if(typeof c==null)delete f[b];else{if(!q(c,"string","shader","code"))return a;f[b]=c}return a};var L=function(a,b,c){var d;if(typeof b=="undefined"){j[a]=[];return}q(b,"function",a,"callback"),typeof c!="undefined"&&q(c,"boolean",a,"active");for(d=0;d<j[a].length;++d)if(j[a][d][0]===b){j[a][d][1]=typeof c=="boolean"?c:!0;return}j[a].push([b,c])};return a.contextlost=function(a,b){L("contextlost",a,b)},a.contextrestored=function(a,b){L("contextrestored",a,b)},a.contextcreationerror=function(a){L("contextcreationerror",a,active)},a.worker=function(a,b){n("(TODO) Workers are not yet implemented...")},typeof exports!="undefined"&&exports!==null&&(exports.glQuery=a),a}();